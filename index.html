<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sans Scale Calculator - Beta v3</title>
    <style>
        :root {
            --color-bg: #1a1d23;
            --color-surface: #252930;
            --color-surface-hover: #2d3139;
            --color-border: rgba(255, 255, 255, 0.1);
            --color-text: #e4e6eb;
            --color-text-secondary: #b0b3b8;
            --color-primary: #32b8c5;
            --color-primary-hover: #2da4b0;
            --color-accent: #ff5555;
            --color-success: #50fa7b;
            --color-warning: #ffb86c;
            --radius: 8px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--color-border);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            color: var(--color-primary);
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 0.95rem;
        }

        .layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .layout {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--color-surface);
            border-radius: var(--radius);
            padding: 24px;
            border: 1px solid var(--color-border);
        }

        .card h2 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--color-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--color-text);
            font-size: 0.9rem;
        }

        .label-hint {
            color: var(--color-text-secondary);
            font-weight: 400;
            font-size: 0.85rem;
            margin-left: 4px;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px 12px;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            color: var(--color-text);
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .slider-container {
            margin-top: 8px;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: var(--color-bg);
            border-radius: 3px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--color-primary);
            cursor: pointer;
            border-radius: 50%;
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--color-primary);
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }

        .slider-value {
            text-align: center;
            font-weight: 600;
            color: var(--color-primary);
            font-size: 1.2rem;
            margin-top: 8px;
        }

        button {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
        }

        button:hover {
            background: var(--color-primary-hover);
        }

        button.secondary {
            background: var(--color-surface-hover);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        button.secondary:hover {
            background: var(--color-bg);
        }

        .result-box {
            background: var(--color-bg);
            border: 2px solid var(--color-primary);
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .result-magnitude {
            font-size: 3rem;
            font-weight: 700;
            color: var(--color-primary);
            margin: 10px 0;
        }

        .result-tier {
            font-size: 1.1rem;
            color: var(--color-text-secondary);
            margin-top: 8px;
        }

        .result-multiplier {
            font-size: 1.2rem;
            color: var(--color-warning);
            margin-top: 8px;
        }

        .database {
            max-height: 600px;
            overflow-y: auto;
        }

        .boss-entry {
            background: var(--color-bg);
            padding: 12px;
            border-radius: var(--radius);
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.2s;
            border: 1px solid transparent;
        }

        .boss-entry:hover {
            background: var(--color-surface-hover);
            border-color: var(--color-primary);
        }

        .boss-entry.selected {
            border-color: var(--color-primary);
            background: var(--color-surface-hover);
        }

        .boss-name {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .boss-stats {
            display: flex;
            gap: 12px;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            flex-wrap: wrap;
        }

        .boss-magnitude {
            color: var(--color-primary);
            font-weight: 600;
        }

        .tier-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .tier-baseline { background: rgba(100, 100, 100, 0.3); }
        .tier-hard { background: rgba(59, 130, 246, 0.3); }
        .tier-very-hard { background: rgba(147, 51, 234, 0.3); }
        .tier-extreme { background: rgba(234, 179, 8, 0.3); }
        .tier-unbeatable { background: rgba(239, 68, 68, 0.3); }
        .tier-impossible { background: rgba(220, 38, 38, 0.3); }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        .comparison-table th {
            color: var(--color-primary);
            font-weight: 600;
            font-size: 0.85rem;
        }

        .comparison-table td {
            font-size: 0.9rem;
        }

        .help-text {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            margin-top: 8px;
            font-style: italic;
        }

        .guide-section {
            background: var(--color-surface);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--color-border);
        }

        .guide-section h3 {
            color: var(--color-primary);
            margin-bottom: 12px;
        }

        .guide-section ul {
            margin-left: 20px;
            margin-top: 8px;
        }

        .guide-section li {
            margin-bottom: 6px;
            color: var(--color-text-secondary);
        }

        .parameter-guide {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }

        .parameter-card {
            background: var(--color-bg);
            padding: 12px;
            border-radius: var(--radius);
            border: 1px solid var(--color-border);
        }

        .parameter-card h4 {
            color: var(--color-primary);
            font-size: 0.95rem;
            margin-bottom: 8px;
        }

        .parameter-card p {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            margin-bottom: 6px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 8px 16px;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .tab:hover {
            border-color: var(--color-primary);
        }

        .tab.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        .practice-ceiling-line {
            border-top: 2px dashed var(--color-accent);
            margin: 16px 0;
            padding-top: 8px;
        }

        .practice-ceiling-label {
            color: var(--color-accent);
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 8px;
        }

        .collapsible {
            cursor: pointer;
            user-select: none;
        }

        .collapsible:hover {
            color: var(--color-primary);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.active {
            max-height: 2000px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sans Scale Calculator</h1>
            <div class="subtitle">Beta v3 - Simplified Boss Difficulty Measurement</div>
            <div class="subtitle" style="margin-top: 8px; font-size: 0.85rem;">
                <strong>Practice Ceiling (SS ~1.20-1.30):</strong> The threshold where practice alone is no longer sufficient.
            </div>
        </header>

        <!-- Guide Section -->
        <div class="guide-section">
            <h3 class="collapsible" onclick="toggleGuide()">Quick Start Guide (Click to Expand)</h3>
            <div id="guideContent" class="collapsible-content">
                <p style="margin-bottom: 12px;">The Sans Scale (SS) uses three simple parameters to calculate boss difficulty relative to Sans from Undertale.</p>
                
                <div class="parameter-guide">
                    <div class="parameter-card">
                        <h4>Mechanical Intensity (MI)</h4>
                        <p><strong>What it measures:</strong> Input density, reaction speed, precision requirements</p>
                        <p><strong>1-3:</strong> Slow-paced, forgiving timing</p>
                        <p><strong>4-6:</strong> Moderate challenge, standard precision</p>
                        <p><strong>7-8:</strong> High APM, tight timing windows</p>
                        <p><strong>9-10:</strong> Extreme speed and precision demands</p>
                    </div>
                    
                    <div class="parameter-card">
                        <h4>Endurance Factor (EF)</h4>
                        <p><strong>What it measures:</strong> Fight duration, stamina drain, consistency needed</p>
                        <p><strong>1-3:</strong> Brief encounter, low fatigue</p>
                        <p><strong>4-6:</strong> Moderate length, sustainable</p>
                        <p><strong>7-8:</strong> Long fight, focus fatigue</p>
                        <p><strong>9-10:</strong> Marathon, extreme endurance test</p>
                    </div>
                    
                    <div class="parameter-card">
                        <h4>Pattern Complexity (PC)</h4>
                        <p><strong>What it measures:</strong> Memorization load, RNG, adaptability</p>
                        <p><strong>1-3:</strong> Simple, repetitive patterns</p>
                        <p><strong>4-6:</strong> Moderate variety, some memorization</p>
                        <p><strong>7-8:</strong> Complex patterns, high learning curve</p>
                        <p><strong>9-10:</strong> Extreme variety or adaptation required</p>
                    </div>
                </div>

                <h4 style="margin-top: 16px; margin-bottom: 8px; color: var(--color-primary);">Build Quality</h4>
                <ul>
                    <li><strong>God-tier (0.65x):</strong> Perfect synergies, trivializes mechanics</li>
                    <li><strong>Optimized (0.75x):</strong> Strong build with clear advantages</li>
                    <li><strong>Good (0.85x):</strong> Solid setup with some benefits</li>
                    <li><strong>Standard (1.0x):</strong> Baseline experience</li>
                    <li><strong>Suboptimal (1.25x):</strong> Missing key items or upgrades</li>
                    <li><strong>Poor (1.5x):</strong> Actively handicapped</li>
                    <li><strong>Challenge (2.0x-3.0x):</strong> Self-imposed restrictions</li>
                </ul>

                <h4 style="margin-top: 16px; margin-bottom: 8px; color: var(--color-primary);">Consistency Multiplier</h4>
                <ul>
                    <li><strong>Normal (1.0x):</strong> Can take multiple hits</li>
                    <li><strong>Low-Margin (1.5x):</strong> Only 2-4 hits allowed</li>
                    <li><strong>Near-Hitless (2.5x):</strong> 1 hit maximum</li>
                    <li><strong>Hitless (3.5x):</strong> No damage allowed</li>
                    <li><strong>Frame-Perfect (4.5x):</strong> Frame-perfect hitless execution</li>
                    <li><strong>Extended Perfect (6.0x+):</strong> Extended frame-perfect requirements</li>
                </ul>

                <h4 style="margin-top: 16px; margin-bottom: 8px; color: var(--color-primary);">Interpreting Results</h4>
                <ul>
                    <li><strong>SS = 1.00:</strong> Same difficulty as Sans (baseline)</li>
                    <li><strong>SS = 1.10:</strong> ~2x harder than Sans</li>
                    <li><strong>SS = 1.30:</strong> ~5x harder than Sans</li>
                    <li><strong>SS = 1.50:</strong> ~10x harder than Sans</li>
                    <li><strong>SS = 2.00:</strong> ~100x harder than Sans</li>
                </ul>
            </div>
        </div>

        <div class="layout">
            <!-- Calculator Panel -->
            <div class="card">
                <h2>Calculate Boss Difficulty</h2>
                
                <div class="form-group">
                    <label>Boss Name</label>
                    <input type="text" id="bossName" placeholder="e.g., Nightmare King Grimm">
                </div>

                <div class="form-group">
                    <label>Mechanical Intensity (MI)</label>
                    <div class="slider-container">
                        <input type="range" id="sliderMI" min="1" max="10" step="0.1" value="5.0" oninput="updateSlider('MI')">
                        <div class="slider-value" id="valueMI">5.0</div>
                    </div>
                    <div class="help-text">Input density, reaction speed, precision requirements</div>
                </div>

                <div class="form-group">
                    <label>Endurance Factor (EF)</label>
                    <div class="slider-container">
                        <input type="range" id="sliderEF" min="1" max="10" step="0.1" value="5.0" oninput="updateSlider('EF')">
                        <div class="slider-value" id="valueEF">5.0</div>
                    </div>
                    <div class="help-text">Fight duration, stamina drain, consistency needed</div>
                </div>

                <div class="form-group">
                    <label>Pattern Complexity (PC)</label>
                    <div class="slider-container">
                        <input type="range" id="sliderPC" min="1" max="10" step="0.1" value="5.0" oninput="updateSlider('PC')">
                        <div class="slider-value" id="valuePC">5.0</div>
                    </div>
                    <div class="help-text">Memorization load, RNG variance, adaptability</div>
                </div>

                <div class="form-group">
                    <label>Build Quality</label>
                    <select id="buildQuality">
                        <option value="0.65">God-tier (0.65x)</option>
                        <option value="0.75">Optimized (0.75x)</option>
                        <option value="0.85">Good (0.85x)</option>
                        <option value="1.0" selected>Standard (1.0x)</option>
                        <option value="1.25">Suboptimal (1.25x)</option>
                        <option value="1.5">Poor (1.5x)</option>
                        <option value="2.0">Challenge Run (2.0x)</option>
                        <option value="2.5">Challenge Run (2.5x)</option>
                        <option value="3.0">Challenge Run (3.0x)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Consistency Multiplier</label>
                    <select id="consistencyMod">
                        <option value="1.0" selected>Normal (1.0x)</option>
                        <option value="1.5">Low-Margin (1.5x)</option>
                        <option value="2.5">Near-Hitless (2.5x)</option>
                        <option value="3.5">Hitless Required (3.5x)</option>
                        <option value="4.5">Frame-Perfect Hitless (4.5x)</option>
                        <option value="6.0">Extended Frame-Perfect (6.0x)</option>
                    </select>
                </div>

                <button onclick="calculateDifficulty()">Calculate Sans Scale</button>

                <div id="result" style="display: none;" class="result-box">
                    <div style="font-size: 0.9rem; color: var(--color-text-secondary);">Sans Scale Magnitude</div>
                    <div class="result-magnitude" id="resultSS">-</div>
                    <div class="result-multiplier" id="resultMult">-</div>
                    <div class="result-tier" id="resultTier">-</div>
                </div>

                <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <button class="secondary" onclick="addToComparison()">Add to Comparison</button>
                    <button class="secondary" onclick="saveToDatabase()">Save to Database</button>
                </div>
            </div>

            <!-- Database Panel -->
            <div class="card">
                <h2>Boss Database</h2>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('all')">All Bosses</div>
                    <div class="tab" onclick="switchTab('beatable')">Below Ceiling</div>
                    <div class="tab" onclick="switchTab('unbeatable')">Above Ceiling</div>
                </div>
                
                <div style="margin-bottom: 12px; text-align: right;">
                    <button class="secondary" style="padding: 6px 12px; font-size: 0.85rem; width: auto;" onclick="resetDatabase()">Reset to Defaults</button>
                </div>

                <div class="database" id="bossDatabase">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Comparison Panel -->
        <div class="card">
            <h2>Comparison View</h2>
            <div id="comparisonView">
                <p style="text-align: center; color: var(--color-text-secondary);">
                    Calculate a boss or select from the database to start comparing
                </p>
            </div>
        </div>
    </div>

    <script>
        const SANS_REFERENCE = 6.475;

        const defaultBosses = [
            // Undertale/Deltarune
            { name: "Sans", MI: 5.5, EF: 7.0, PC: 7.5, build: 1.0, consistency: 1.0, SS: 1.00 },
            { name: "Undyne the Undying", MI: 5.8, EF: 6.5, PC: 6.0, build: 1.0, consistency: 1.0, SS: 0.97 },
            { name: "Jevil", MI: 6.5, EF: 4.5, PC: 7.0, build: 1.0, consistency: 1.0, SS: 0.96 },
            { name: "Jevil (Good Build)", MI: 6.5, EF: 4.5, PC: 7.0, build: 0.85, consistency: 1.0, SS: 0.89 },
            { name: "The Roaring Knight", MI: 7.8, EF: 5.5, PC: 6.5, build: 1.0, consistency: 1.0, SS: 1.02 },
            { name: "The Roaring Knight (Optimized)", MI: 7.8, EF: 5.5, PC: 6.5, build: 0.75, consistency: 1.0, SS: 0.89 },
            { name: "The Roaring Knight (Suboptimal)", MI: 7.8, EF: 5.5, PC: 6.5, build: 1.25, consistency: 1.0, SS: 1.11 },
            
            // Hollow Knight - Moderate
            { name: "Nightmare King Grimm", MI: 7.5, EF: 4.5, PC: 8.5, build: 1.0, consistency: 1.0, SS: 1.02 },
            { name: "Lost Kin", MI: 7.8, EF: 6.5, PC: 7.5, build: 1.0, consistency: 1.0, SS: 1.05 },
            { name: "Pure Vessel", MI: 8.5, EF: 5.5, PC: 9.0, build: 1.0, consistency: 1.0, SS: 1.06 },
            
            // Hollow Knight - Extreme
            { name: "Absolute Radiance", MI: 9.0, EF: 7.5, PC: 9.5, build: 1.0, consistency: 1.0, SS: 1.12 },
            { name: "Absolute Radiance (Hitless)", MI: 9.5, EF: 9.0, PC: 10.0, build: 1.0, consistency: 1.0, SS: 1.16 },
            
            // Community Challenges
            { name: "ANY Radiance 1.0", MI: 9.8, EF: 9.5, PC: 10.0, build: 1.0, consistency: 2.5, SS: 1.58 },
            { name: "ANY Radiance 2.0", MI: 10.0, EF: 10.0, PC: 10.0, build: 1.0, consistency: 4.0, SS: 1.79 },
            { name: "ANY Radiance 3.0", MI: 10.0, EF: 10.0, PC: 10.0, build: 1.0, consistency: 5.5, SS: 1.93 }
        ];

        let bossDatabase = [];
        let comparisonBosses = [];
        let currentTab = 'all';

        function loadDatabase() {
            const saved = localStorage.getItem('bossDatabase_v3');
            if (saved) {
                bossDatabase = JSON.parse(saved);
            } else {
                bossDatabase = [...defaultBosses];
                saveDatabase();
            }
        }

        function saveDatabase() {
            localStorage.setItem('bossDatabase_v3', JSON.stringify(bossDatabase));
        }

        function resetDatabase() {
            if (confirm('Reset database to defaults? This will remove any custom bosses you have added.')) {
                bossDatabase = [...defaultBosses];
                saveDatabase();
                renderDatabase();
            }
        }

        function updateSlider(param) {
            const value = document.getElementById('slider' + param).value;
            document.getElementById('value' + param).textContent = parseFloat(value).toFixed(1);
        }

        function calculateSansScale(MI, EF, PC, buildMod, consistencyMod) {
            const baseScore = (MI * 0.45) + (EF * 0.35) + (PC * 0.20);
            const adjustedScore = baseScore * buildMod * consistencyMod;
            const ratio = adjustedScore / SANS_REFERENCE;
            
            let magnitude;
            if (ratio >= 1.0) {
                magnitude = Math.log10(ratio) + 1.0;
            } else {
                magnitude = (ratio - 1.0) * 0.5 + 1.0;
            }
            
            const multiplier = Math.pow(10, magnitude - 1.0);
            
            return {
                magnitude: magnitude,
                multiplier: multiplier,
                baseScore: baseScore,
                adjustedScore: adjustedScore
            };
        }

        function getTier(SS) {
            if (SS < 1.05) return { name: "Baseline", class: "tier-baseline" };
            if (SS < 1.15) return { name: "Hard", class: "tier-hard" };
            if (SS < 1.30) return { name: "Very Hard", class: "tier-very-hard" };
            if (SS < 1.50) return { name: "Extreme", class: "tier-extreme" };
            if (SS < 2.00) return { name: "Practically Unbeatable", class: "tier-unbeatable" };
            return { name: "Near Impossible", class: "tier-impossible" };
        }

        function calculateDifficulty() {
            const MI = parseFloat(document.getElementById('sliderMI').value);
            const EF = parseFloat(document.getElementById('sliderEF').value);
            const PC = parseFloat(document.getElementById('sliderPC').value);
            const buildMod = parseFloat(document.getElementById('buildQuality').value);
            const consistencyMod = parseFloat(document.getElementById('consistencyMod').value);

            const result = calculateSansScale(MI, EF, PC, buildMod, consistencyMod);
            const tier = getTier(result.magnitude);

            document.getElementById('resultSS').textContent = `SS = ${result.magnitude.toFixed(2)}`;
            document.getElementById('resultMult').textContent = `${result.multiplier.toFixed(2)}x harder than Sans`;
            document.getElementById('resultTier').innerHTML = `<span class="tier-badge ${tier.class}">${tier.name}</span>`;
            document.getElementById('result').style.display = 'block';

            window.currentCalculation = {
                name: document.getElementById('bossName').value || "Custom Boss",
                MI, EF, PC,
                build: buildMod,
                consistency: consistencyMod,
                SS: result.magnitude
            };
        }

        function addToComparison() {
            if (!window.currentCalculation) {
                alert("Please calculate a boss first!");
                return;
            }

            const exists = comparisonBosses.find(b => b.name === window.currentCalculation.name);
            if (exists) {
                alert("This boss is already in the comparison!");
                return;
            }

            comparisonBosses.push(window.currentCalculation);
            updateComparisonView();
        }

        function loadBoss(boss) {
            document.getElementById('bossName').value = boss.name;
            document.getElementById('sliderMI').value = boss.MI;
            document.getElementById('sliderEF').value = boss.EF;
            document.getElementById('sliderPC').value = boss.PC;
            document.getElementById('buildQuality').value = boss.build;
            document.getElementById('consistencyMod').value = boss.consistency;
            
            updateSlider('MI');
            updateSlider('EF');
            updateSlider('PC');
            
            calculateDifficulty();
            
            document.querySelectorAll('.boss-entry').forEach(el => el.classList.remove('selected'));
            event.target.closest('.boss-entry').classList.add('selected');
        }

        function renderDatabase() {
            const container = document.getElementById('bossDatabase');
            let bosses = [...bossDatabase];

            if (currentTab === 'beatable') {
                bosses = bosses.filter(b => b.SS < 1.30);
            } else if (currentTab === 'unbeatable') {
                bosses = bosses.filter(b => b.SS >= 1.30);
            }

            let html = '';
            let needsCeiling = false;

            bosses.forEach((boss) => {
                if (!needsCeiling && boss.SS >= 1.20) {
                    html += `
                        <div class="practice-ceiling-line">
                            <div class="practice-ceiling-label">PRACTICE CEILING (SS ~1.20-1.30) - Practice Alone No Longer Sufficient</div>
                        </div>
                    `;
                    needsCeiling = true;
                }

                const tier = getTier(boss.SS);
                const result = calculateSansScale(boss.MI, boss.EF, boss.PC, boss.build, boss.consistency);
                
                html += `
                    <div class="boss-entry" onclick="loadBoss(bossDatabase[${bossDatabase.indexOf(boss)}])">
                        <div class="boss-name">
                            ${boss.name}
                            <span class="tier-badge ${tier.class}">${tier.name}</span>
                        </div>
                        <div class="boss-stats">
                            <span class="boss-magnitude">SS = ${boss.SS.toFixed(2)}</span>
                            <span>MI: ${boss.MI}</span>
                            <span>EF: ${boss.EF}</span>
                            <span>PC: ${boss.PC}</span>
                            <span>Build: ${boss.build}x</span>
                            <span>Consistency: ${boss.consistency}x</span>
                            <span style="color: var(--color-warning);">${result.multiplier.toFixed(2)}x</span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updateComparisonView() {
            const container = document.getElementById('comparisonView');
            
            if (comparisonBosses.length === 0) {
                container.innerHTML = `
                    <p style="text-align: center; color: var(--color-text-secondary);">
                        Calculate a boss or select from the database to start comparing
                    </p>
                `;
                return;
            }

            const sorted = [...comparisonBosses].sort((a, b) => a.SS - b.SS);

            let html = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Boss</th>
                            <th>SS</th>
                            <th>Multiplier</th>
                            <th>MI</th>
                            <th>EF</th>
                            <th>PC</th>
                            <th>Build</th>
                            <th>Consistency</th>
                            <th>Tier</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sorted.forEach(boss => {
                const tier = getTier(boss.SS);
                const result = calculateSansScale(boss.MI, boss.EF, boss.PC, boss.build, boss.consistency);
                
                html += `
                    <tr>
                        <td><strong>${boss.name}</strong></td>
                        <td style="color: var(--color-primary); font-weight: 600;">${boss.SS.toFixed(2)}</td>
                        <td style="color: var(--color-warning);">${result.multiplier.toFixed(2)}x</td>
                        <td>${boss.MI}</td>
                        <td>${boss.EF}</td>
                        <td>${boss.PC}</td>
                        <td>${boss.build}x</td>
                        <td>${boss.consistency}x</td>
                        <td><span class="tier-badge ${tier.class}">${tier.name}</span></td>
                        <td><button class="secondary" style="padding: 4px 8px; font-size: 0.8rem; width: auto;" onclick="removeFromComparison('${boss.name}')">Remove</button></td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="secondary" onclick="clearComparison()">Clear All</button>
                </div>
            `;

            container.innerHTML = html;
        }

        function removeFromComparison(name) {
            comparisonBosses = comparisonBosses.filter(b => b.name !== name);
            updateComparisonView();
        }

        function clearComparison() {
            comparisonBosses = [];
            updateComparisonView();
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            renderDatabase();
        }

        function saveToDatabase() {
            if (!window.currentCalculation) {
                alert("Please calculate a boss first!");
                return;
            }

            const exists = bossDatabase.find(b => b.name === window.currentCalculation.name);
            if (exists) {
                if (confirm(`"${window.currentCalculation.name}" already exists. Overwrite?`)) {
                    const index = bossDatabase.indexOf(exists);
                    bossDatabase[index] = window.currentCalculation;
                    saveDatabase();
                    renderDatabase();
                    alert("Boss updated in database!");
                }
            } else {
                bossDatabase.push(window.currentCalculation);
                bossDatabase.sort((a, b) => a.SS - b.SS);
                saveDatabase();
                renderDatabase();
                alert("Boss added to database!");
            }
        }

        function toggleGuide() {
            const content = document.getElementById('guideContent');
            content.classList.toggle('active');
        }

        // Initialize
        loadDatabase();
        renderDatabase();
    </script>
</body>
</html>
